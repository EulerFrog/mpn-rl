flowchart TB
    subgraph Current["CURRENT: Transition-Based Training"]
        A1[Environment Step] --> B1[Single Transition<br/>obs action reward next_obs done state_t]
        B1 --> C1[ReplayBuffer<br/>Store transition]
        C1 --> D1[Random Sample<br/>64 transitions]
        D1 --> E1[Compute TD Loss<br/>Problem: Uses STALE states]
        E1 --> F1[Network Update]

        style D1 fill:#ffcccc,stroke:#ff0000,stroke-width:3px
        style E1 fill:#ffcccc,stroke:#ff0000,stroke-width:3px
    end

    subgraph Proposed["PROPOSED: Trial-Based Training"]
        A2[Environment Trial<br/>100-800 timesteps] --> B2[Complete Trial Sequence<br/>obs_list action_list reward_list done_list]
        B2 --> C2[TrialReplayBuffer<br/>Store complete trial]
        C2 --> D2[Sample Trials<br/>4 complete trials]
        D2 --> E2[Replay Each Trial<br/>Regenerate FRESH states]
        E2 --> F2[Accumulate TD Loss<br/>over full sequence]
        F2 --> G2[Network Update]

        style D2 fill:#ccffcc,stroke:#00aa00,stroke-width:3px
        style E2 fill:#ccffcc,stroke:#00aa00,stroke-width:3px
        style F2 fill:#ccffcc,stroke:#00aa00,stroke-width:3px
    end
